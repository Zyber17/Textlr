$(document).ready(function(){function a(){var f=new Date();var d=f.getHours();var e=f.getMinutes();if((d==20&&e>=30)||(d>20)||(d<=4)){document.body.className="dark"}}a();var c=$("#text");var b;jQuery.extend(jQuery.browser,{SafariMobile:navigator.userAgent.toLowerCase().match(/iP(hone|ad)/i)});if($.browser.SafariMobile){window.scrollTo(0,1)}if(!$.browser.SafariMobile){c.attr("placeholder",($("#text").attr("placeholder")+" Need help? Type: !help."));c.focus();$("#form").submit(function(d){d.preventDefault();$("#submit",this).attr("disabled","disabled");$("#text",this).attr("readonly","readonly").addClass("fade");var e=$("#text").val();$.post("stuff.php",{text:e,ajax:true},function(i){if(i!="Error"){var g=JSON.parse(i);var j;if(g.title){var f;if(g.title.length>107){var h;if(g.title.substring(105,106)==" "){h=105}else{h=106}f=g.title.substr(0,h)+"…"}else{f=g.title}j="&text="+encodeURIComponent(f)}else{j=""}$("#wrapper").append('<div id="url"><input type="text" value="http://textlr.org/'+g.url+'" onclick="this.focus();this.select();" readonly="readonly" /><a href="'+g.url+'">See the uploaded text.</a><a href="https://twitter.com/share?url=http://textlr.org/'+g.url+j+'&via=Textlr" target="_blank">Tweet it.</a>');$("#url input").focus().select()}else{alert("Error")}})});c.bind("keydown",function(d){if(d.metaKey&&d.keyCode==13){$("#submit").click()}else{if(d.metaKey&&d.altKey){window.preview(true)}}});$(document).keyup(function(d){if($(".preview").length>0){hidepreview()}})}c.keyup(function(){var f=$(this);var e=f.getSelection().end;var d=/!(\S+)$/.exec(this.value.slice(0,e));var h=d?d[1]:null;var j=["help","date","donate","commands","preview"];for(item in j){if(j[item]==h){var g=window[j[item]]();var i=f.val().replace("!"+j[item],g);$(this).val(i)}}})});function preview(a){if($(".preview").length==0&&$("#url").length==0){var b=$("#text").val();if(b.length>2){if(!a){b=b.replace(/!preview/,"")}$.post("stuff.php",{markdown:b,ajax:true},function(c){$("#typist").hide();$("footer").hide();$("#wrapper").append("<article class='preview'>"+c+"</article>");var d=$(".preview").text();if(!a){$("#wrapper").append('<button onclick="hidepreview()" class="okay" id="donepreview">I\'m done previewing.</button>')}$("#wrapper").append("<div class='textinfo'><h3>Characters: <b>"+(d.length-1)+"</b></h3><h3>Words: <b>"+d.split(" ").length+"</b></h3></div>")})}}if(!a){return""}}function hidepreview(){if($(".preview").length>0){$("#typist").show();$("footer").show();$(".preview").remove();$(".textinfo").remove();if($("#donepreview").length>0){$("#donepreview").remove()}text.blur();text.focus()}}function hidepopover(){$("#typist").show();$("footer").show();text.focus();$(".popover").remove()}function date(){var a=new Date();return $.format.date(a,"M/d/yy")}function donate(){window.location="donate.html";return""}function commands(){text.blur();$("#typist").hide();$("footer").hide();$("#wrapper").append('<section id="commands" class="popover"><h1>Extendsorize.</h1><h2>Textlr has a lot <code>!commands</code> that will make using Textlr even more awesome.</h2><ul><li><h3><code>!help</code></h3><p>Brings up the <a href="javascript:hidepopover();help();">help</a> page.</p></li><li><h3><code>!commands</code></h3><p>Brings up this page</p></li><li><h3><code>!date</code></h3><p>Inserts the current date into the text in the format: <code>M/d/yy</code>. For example <em>October 8, 2012</em> would become <em>10/8/12</em>.</p></li><li><h3><code>!preview</code></h3><p>Pulls up the preview UI that is normally pulled up by ⌘⌥ (cmd+alt). (Useful when on a moble device.)</p></li><li><h3><code>!donate</code></h3><p>Redirects to the <a href="donate.html">donation page</a>.</p></li></ul><h3>Am I missing something? <a href="mailto:hello@zyber17.com?subject=Textlr Commands">Email me</a>.</h3><h2 class="okay">Got it?</h2><button onclick="hidepopover();" class="okay">Got it.</button></section>');return""}function help(){text.blur();$("#typist").hide();$("footer").hide();$("#wrapper").append('<section id="help" class="popover"><h1>Have Some Help.</h1><h2>Textlr has a lot of cool features that you probably didn\'t know about. Here\'s how to use them.</h2><ul><li><h3>Markdown.</h3><p>All your documents will be parsed through <a href="http://daringfireball.net/projects/markdown/">Markdown</a>.</p></li><li><h3>Title your work.</h3><p>If you\'re a markdown user, you know that a line starting with <code>#</code> will become a first-level heading. If the first line of your document is a first level heading we automatically use it as title of your document. It\'s a as simple as that.</p><ul><li><h3>I don\'t want a title!</h3><p>Don\'t want your work to be titled but want your document to being with a first level heading? No worries, Just make the top line of your document empty.</p></li></ul></li><li><h3>Preview.</h3><p>Want to preview your document? Just press and hold ⌘⌥ (cmd+alt) on a Mac. Theoretically it\'d be Windows Key+Alt on a PC but that\'s never been tested.</p></li><li><h3>Go out with a bang.</h3><p>Textlr supports <a href="javascript:hidepopover();commands();"><code>!commands</code></a> (said: "bang commands") that essentially are typing typing shortcuts. In fact you used one (<code>!help</code>) to get here! <a href="javascript:hidepopover();commands();">Here\'s a list of them.</a></p></li><li><h3>I wish I didn\'t have to move my mouse so far to click that "Upload" button.</h3><p>You don\'t! Just press ⌘↩ (cmd+enter) when you want to submit on a Mac. Theoretically it\'d be Windows Key+Enter on a PC but that\'s never been tested.</p></li></ul><h2 class="okay">Got it?</h2><button onclick="hidepopover();" class="okay">Got it.</button></section>');return""}(function(h){var f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var j=["January","February","March","April","May","June","July","August","September","October","November","December"];var g=[];g.Jan="01";g.Feb="02";g.Mar="03";g.Apr="04";g.May="05";g.Jun="06";g.Jul="07";g.Aug="08";g.Sep="09";g.Oct="10";g.Nov="11";g.Dec="12";h.format=(function(){function b(l){return f[parseInt(l,10)]||l}function a(m){var n=parseInt(m,10)-1;return i[n]||m}function c(m){var n=parseInt(m,10)-1;return j[n]||m}var e=function(l){return g[l]||l};var d=function(t){var s=t;var q="";if(s.indexOf(".")!==-1){var p=s.split(".");s=p[0];q=p[1]}var r=s.split(":");if(r.length===3){hour=r[0];minute=r[1];second=r[2];return{time:s,hour:hour,minute:minute,second:second,millis:q}}else{return{time:"",hour:"",minute:"",second:"",millis:""}}};return{date:function(K,L){try{var G=null;var O=null;var A=null;var I=null;var F=null;var H=null;if(typeof K.getFullYear==="function"){O=K.getFullYear();A=K.getMonth()+1;I=K.getDate();F=K.getDay();H=d(K.toTimeString())}else{if(K.search(/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.?\d{0,3}[-+]?\d{2}:?\d{2}/)!=-1){var J=K.split(/[T\+-]/);O=J[0];A=J[1];I=J[2];H=d(J[3].split(".")[0]);G=new Date(O,A-1,I);F=G.getDay()}else{var J=K.split(" ");switch(J.length){case 6:O=J[5];A=e(J[1]);I=J[2];H=d(J[3]);G=new Date(O,A-1,I);F=G.getDay();break;case 2:var M=J[0].split("-");O=M[0];A=M[1];I=M[2];H=d(J[1]);G=new Date(O,A-1,I);F=G.getDay();break;case 7:case 9:case 10:O=J[3];A=e(J[1]);I=J[2];H=d(J[4]);G=new Date(O,A-1,I);F=G.getDay();break;default:return K}}}var P="";var C="";for(var D=0;D<L.length;D++){var N=L.charAt(D);P+=N;switch(P){case"ddd":C+=b(F);P="";break;case"dd":if(L.charAt(D+1)=="d"){break}if(String(I).length===1){I="0"+I}C+=I;P="";break;case"d":if(L.charAt(D+1)=="d"){break}C+=parseInt(I,10);P="";break;case"MMMM":C+=c(A);P="";break;case"MMM":if(L.charAt(D+1)==="M"){break}C+=a(A);P="";break;case"MM":if(L.charAt(D+1)=="M"){break}if(String(A).length===1){A="0"+A}C+=A;P="";break;case"M":if(L.charAt(D+1)=="M"){break}C+=A;P="";break;case"yyyy":C+=O;P="";break;case"yy":if(L.charAt(D+1)=="y"&&L.charAt(D+2)=="y"){break}C+=String(O).slice(-2);P="";break;case"HH":C+=H.hour;P="";break;case"hh":var E=(H.hour==0?12:H.hour<13?H.hour:H.hour-12);E=String(E).length==1?"0"+E:E;C+=E;P="";break;case"h":if(L.charAt(D+1)=="h"){break}var E=(H.hour==0?12:H.hour<13?H.hour:H.hour-12);C+=parseInt(E,10);P="";break;case"mm":C+=H.minute;P="";break;case"ss":C+=H.second.substring(0,2);P="";break;case"SSS":C+=H.millis.substring(0,3);P="";break;case"a":C+=H.hour>=12?"PM":"AM";P="";break;case" ":C+=N;P="";break;case"/":C+=N;P="";break;case":":C+=N;P="";break;default:if(P.length===2&&P.indexOf("y")!==0&&P!="SS"){C+=P.substring(0,1);P=P.substring(1,2)}else{if((P.length===3&&P.indexOf("yyy")===-1)){P=""}}}}return C}catch(B){console.log(B);return K}}}}())}($));$.format.date.defaultShortDateFormat="dd/MM/yyyy";$.format.date.defaultLongDateFormat="dd/MM/yyyy hh:mm:ss";$(document).ready(function(){$(".shortDateFormat").each(function(d,c){if($(c).is(":input")){$(c).val($.format.date($(c).val(),$.format.date.defaultShortDateFormat))}else{$(c).text($.format.date($(c).text(),$.format.date.defaultShortDateFormat))}});$(".longDateFormat").each(function(d,c){if($(c).is(":input")){$(c).val($.format.date($(c).val(),$.format.date.defaultLongDateFormat))}else{$(c).text($.format.date($(c).text(),$.format.date.defaultLongDateFormat))}})});(function(e){function d(k,i){var h=typeof k[i];return h==="function"||!!(h=="object"&&k[i])||h=="unknown"}function c(k,i,h){if(i<0){i+=k.value.length}if(typeof h=="undefined"){h=i}if(h<0){h+=k.value.length}return{start:i,end:h}}function j(){return typeof document.body=="object"&&document.body?document.body:document.getElementsByTagName("body")[0]}var v,w,b,g,a,z,y,x,f;e(document).ready(function(){function i(l,k){return function(){var n=this.jquery?this[0]:this,m=n.nodeName.toLowerCase();if(n.nodeType==1&&(m=="textarea"||m=="input"&&n.type=="text")){n=[n].concat(Array.prototype.slice.call(arguments));n=l.apply(this,n);if(!k){return n}}if(k){return this}}}var h=document.createElement("textarea");j().appendChild(h);if(typeof h.selectionStart!="undefined"&&typeof h.selectionEnd!="undefined"){v=function(k){return{start:k.selectionStart,end:k.selectionEnd,length:k.selectionEnd-k.selectionStart,text:k.value.slice(k.selectionStart,k.selectionEnd)}};w=function(l,k,m){k=c(l,k,m);l.selectionStart=k.start;l.selectionEnd=k.end};f=function(l,k){if(k){l.selectionEnd=l.selectionStart}else{l.selectionStart=l.selectionEnd}}}else{if(d(h,"createTextRange")&&typeof document.selection=="object"&&document.selection&&d(document.selection,"createRange")){v=function(l){var k=0,p=0,o,n,m;if((m=document.selection.createRange())&&m.parentElement()==l){n=l.value.length;o=l.value.replace(/\r\n/g,"\n");p=l.createTextRange();p.moveToBookmark(m.getBookmark());m=l.createTextRange();m.collapse(false);if(p.compareEndPoints("StartToEnd",m)>-1){k=p=n}else{k=-p.moveStart("character",-n);k+=o.slice(0,k).split("\n").length-1;if(p.compareEndPoints("EndToEnd",m)>-1){p=n}else{p=-p.moveEnd("character",-n);p+=o.slice(0,p).split("\n").length-1}}}return{start:k,end:p,length:p-k,text:l.value.slice(k,p)}};w=function(l,k,n){k=c(l,k,n);n=l.createTextRange();var m=k.start-(l.value.slice(0,k.start).split("\r\n").length-1);n.collapse(true);if(k.start==k.end){n.move("character",m)}else{n.moveEnd("character",k.end-(l.value.slice(0,k.end).split("\r\n").length-1));n.moveStart("character",m)}n.select()};f=function(l,k){var m=document.selection.createRange();m.collapse(k);m.select()}}else{j().removeChild(h);window.console&&window.console.log&&window.console.log("TextInputs module for Rangy not supported in your browser. Reason: No means of finding text input caret position");return}}j().removeChild(h);g=function(l,k,o,n){var m;if(k!=o){m=l.value;l.value=m.slice(0,k)+m.slice(o)}n&&w(l,k,k)};b=function(l){var k=v(l);g(l,k.start,k.end,true)};x=function(l){var k=v(l),m;if(k.start!=k.end){m=l.value;l.value=m.slice(0,k.start)+m.slice(k.end)}w(l,k.start,k.start);return k.text};a=function(l,k,o,n){var m=l.value;l.value=m.slice(0,o)+k+m.slice(o);if(n){k=o+k.length;w(l,k,k)}};z=function(l,k){var n=v(l),m=l.value;l.value=m.slice(0,n.start)+k+m.slice(n.end);n=n.start+k.length;w(l,n,n)};y=function(l,k,o){var n=v(l),m=l.value;l.value=m.slice(0,n.start)+k+n.text+o+m.slice(n.end);k=n.start+k.length;w(l,k,k+n.length)};e.fn.extend({getSelection:i(v,false),setSelection:i(w,true),collapseSelection:i(f,true),deleteSelectedText:i(b,true),deleteText:i(g,true),extractSelectedText:i(x,false),insertText:i(a,true),replaceSelectedText:i(z,true),surroundSelectedText:i(y,true)})})})(jQuery);